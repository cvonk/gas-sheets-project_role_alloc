# Project Role Allocations (Google Apps Script for Sheets)

Create project role allocation pivot table based on projects names, users and their roles.

## Use

The names of tables at the far end of this code.
Even if you don't ready anything else, please read through the examples below.
The script can be used as a continuation of the sheet generated by the
script [gas-sheets-merge](https://github.com/cvonk/gas-sheets-merge).

## Dependencies

This script requires the Sheets API. Failure to enable the API and list it as a resource
in the script editor causes the error `Reference error: Sheets is not defined`).  To
enable the API, refer to 
[stackoverflow](https://stackoverflow.com/questions/45625971/referenceerror-sheets-is-not-defined).
This API has a default quota of 100 reads/day, after that it 
throws a meaningless error message such as `Internal Error`.

## Example 1

In the first example, we start with a sheet containing the project names, users
and their roles.  We filter out the items we're interested in, and generate
a Pivot Table showing the project role allocations.

### Input

  Starting with the projects names, users and their roles in sheet *persons*.
  Note that multiple projects may be assigned to a single `username`.
  
  | Username | Role    | Type      | Project 1 | Project 2 |
  | -------- | ------- | --------- | --------- | --------- |
  | jvonk    | Student | person    | School    | Java      |  
  | svonk    | Student | person    | School    | Reading   |
  | brlevins | Adult   | person    | BoBo      |           |  
  | tiger    | Pet     | cat       | Purr      |           |
  | ownen    | Pet     | cat       | Sleep     | Purr      |

### Filter

  Filter out the people using `Data > Create a Filter > filter on Type == person`

  | Username | Role    | Type      | Project 1 | Project 2 |
  | -------- | ------- | --------- | --------- | --------- |
  | jvonk    | Student | person    | School    | Java      |  
  | svonk    | Student | person    | School    | Reading   |
  | brlevins | Adult   | person    | BoBo      |           |  
  
### Run the script

  Either from the script editor ("Tools > Script Editor), or by adding a
  little bit of code to create a menu item, such as 

```javascript
    function onOpen() {
      SpreadsheetApp.getUi().createMenu("CUSTOM")
         .addItem("Project role alloc", "onProjectRoleAlloc").addToUi();
    }
```

  The sheet names are declared at the end of the script in

```javascript
    onProjectRoleAlloc.main(srcColumnLabels = ["Project*", "Username", "Role" ],
                            srcSheetName = "persons",
                            pvtSheetName = "role-alloc");
```

  The `srcColumnLabels` uses a wildchard in `Projects*` to indicate that all
  columns starting with `Projects` should be considered.

  Running `OnPivot.main()` generates a sheet called *role-alloc-raw* and
  the pivot table *role-alloc*.
  
### Intermetiate output

  Underwater, the script creates a sheet that forms the raw input for the Pivot
  Table (*role-alloc-raw*)

  | Project  | Username | Role    | Ratio |
  | -------- | -------- | ------- | ----- |
  | School   | jvonk    | Student | 0.5   | 
  | Java     | jvonk    | Student | 0.5   | 
  | School   | svonk    | Student | 0.5   | 
  | Reading  | svonk    | Student | 0.5   |
  | All else | cvonk    | Adult   | 1.0   |
  | BoBo     | brlevins | Adult   | 0.5   |

### Output

  The script creates a project role allocation Pivot Table (*role-alloc*)

  | Project | Username | Student | Adult |
  | ------- | -------- | ------- | ----- |
  | School  | jvonk    | 0.5     |       |
  |         | svonk    | 0.5     |       |
  | Java    | jvonk    | 0.5     |       |
  | Reading | svonk    | 0.5     |       |
  | BoBo    | brlevins |         | 1.0   |
  
## Example 2

In this example we show that projects can be grouped together into themes.

### Input

  Starting with the projects names, users and their roles in sheet *persons*
  
  | Username | Role    | Type      | Project 1 | Project 2 |
  | -------- | ------- | --------- | --------- | --------- |
  | jvonk    | Student | person    | School    | Java      |  
  | svonk    | Student | person    | School    | Reading   |
  | brlevins | Adult   | person    | BoBo      |           |  

### Themes

  The projects are grouped into themes using the sheet *themes*
  
  | Project  | Theme  |
  | -------- | ------ |
  | School   | Study  |
  | Java     | Study  |
  | Laundry  | Chores | 
  | All else | Chores |
  | Chef     | Chores |
  | Reading  | Relax  |
  | BoBo     | Work   |

### Run the script

  Running `OnPivot.main()` generates a sheet called *role-alloc-raw* and
  the pivot table *role-alloc*.

```javascript
    onProjectRoleAlloc.main(srcColumnLabels = ["Project*", "Username", "Role" ],
                            srcSheetName = "persons",
                            pvtSheetName = "role-alloc",
                            theSheetName = "themes");
```

### Intermetiate output

  Underwater, the script creates a sheet that forms the raw input for the Pivot
  Table (*role-alloc-raw*)

  | Theme  | Project  | Username | Role    | Ratio |
  | ------ | -------- | -------- | ------- | ----- |
  | Study  | School   | jvonk    | Student | 0.5   | 
  | Study  | Java     | jvonk    | Student | 0.5   | 
  | Study  | School   | svonk    | Student | 0.5   | 
  | Relax  | Reading  | svonk    | Student | 0.5   |
  | Chores | All else | cvonk    | Adult   | 1.0   |
  | Work   | BoBo     | brlevins | Adult   | 0.5   |
  | Chores | Chef     | brlevins | Adult   | 0.5   |

### Output

  The script creates a project role allocation pivot table (*role-alloc*)

  | Theme   | Project | Username | Student | Adult |
  | ------- | ------- | -------- | ------- | ----- |
  | Study   | School  | jvonk    | 0.5     |       |
  |         |         | svonk    | 0.5     |       |
  |         | Java    | jvonk    | 0.5     |       |
  | Relax   | Reading | svonk    | 0.5     |       |
  | Work    | BoBo    | brlevins |         | 1.0   |
